<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejemplos de Uso - API Client</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        body { background: #f5f7fa; padding: 20px; }
        .card { margin-bottom: 20px; }
        .badge-success { background: #10b981; }
        .badge-error { background: #ef4444; }
        pre { border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">üîó Gu√≠a de Uso - API Client</h1>
        <p class="lead">Sistema para consumir la API externa de autenticaci√≥n y datos</p>

        <!-- Ejemplo 1: Login -->
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">1Ô∏è‚É£ Autenticaci√≥n (Login)</h5>
            </div>
            <div class="card-body">
                <p>Ya implementado en <code>Admiin.php</code>. El token JWT se guarda autom√°ticamente en sesi√≥n.</p>
                <pre><code class="language-php">&lt;?php
// El c√≥digo actual en Admiin.php hace:
// 1. POST a http://localhost:3000/auth/login
// 2. Recibe el token JWT
// 3. Guarda en $_SESSION['jwt_token']

// Respuesta esperada de la API:
{
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "token_type": "Bearer",
    "expires_in": 86400,
    "user_info": {
        "id_empleado": 1029.0,
        "nombre": "IBARRA HERNANDEZ ADRIAN",
        "area": "Auditoria",
        "usuario": "adrian.ibarra"
    }
}
?&gt;</code></pre>
            </div>
        </div>

        <!-- Ejemplo 2: Usar APIClient -->
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">2Ô∏è‚É£ Hacer Peticiones con el Token (APIClient)</h5>
            </div>
            <div class="card-body">
                <h6>Ejemplo: Obtener informaci√≥n del usuario</h6>
                <pre><code class="language-php">&lt;?php
require_once 'api_client.php';

// Obtener instancia del cliente
$api = getAPIClient();

// Hacer GET a /api/usuario
$response = $api->get('api/usuario');

if ($response['success']) {
    $usuario = $response['data'];
    echo "Nombre: " . $usuario['nombre'];
    echo "√Årea: " . $usuario['area'];
} else {
    echo "Error: " . $response['error'];
}
?&gt;</code></pre>

                <h6 class="mt-4">Ejemplo: Crear un pedido (POST)</h6>
                <pre><code class="language-php">&lt;?php
require_once 'api_client.php';

$api = getAPIClient();

// POST a /api/pedidos
$response = $api->post('api/pedidos', [
    'producto' => 'Comida',
    'cantidad' => 2,
    'comentarios' => 'Sin cebolla'
]);

if ($response['success']) {
    $pedido = $response['data'];
    echo "Pedido creado: " . $pedido['id'];
} else {
    echo "Error: " . $response['error'];
}
?&gt;</code></pre>

                <h6 class="mt-4">Ejemplo: Actualizar datos (PUT)</h6>
                <pre><code class="language-php">&lt;?php
$api = getAPIClient();

// PUT a /api/usuario/perfil
$response = $api->put('api/usuario/perfil', [
    'telefono' => '5551234567',
    'email' => 'nuevo@email.com'
]);
?&gt;</code></pre>

                <h6 class="mt-4">Ejemplo: Eliminar (DELETE)</h6>
                <pre><code class="language-php">&lt;?php
$api = getAPIClient();

// DELETE a /api/pedidos/123
$response = $api->delete('api/pedidos/123');
?&gt;</code></pre>
            </div>
        </div>

        <!-- Ejemplo 3: Verificar Token -->
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">3Ô∏è‚É£ Verificar Token y Proteger P√°ginas</h5>
            </div>
            <div class="card-body">
                <pre><code class="language-php">&lt;?php
session_start();
require_once 'api_client.php';

$api = getAPIClient();

// Verificar si est√° autenticado
if (!$api->isAuthenticated()) {
    // Token inv√°lido o expirado
    header('Location: Admiin.php');
    exit;
}

// Verificar si el token est√° expirado
if ($api->isTokenExpired()) {
    // Cerrar sesi√≥n y redirigir
    session_destroy();
    header('Location: Admiin.php?error=token_expirado');
    exit;
}

// Usuario autenticado, continuar...
?&gt;</code></pre>
            </div>
        </div>

        <!-- Ejemplo 4: JavaScript Frontend -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">4Ô∏è‚É£ Desde JavaScript (Frontend)</h5>
            </div>
            <div class="card-body">
                <p>Para hacer peticiones directamente desde el navegador:</p>
                <pre><code class="language-javascript">// 1. Login desde JavaScript
async function login() {
    const response = await fetch('http://localhost:3000/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            usuario: 'adrian.ibarra',
            contrasena: 'Adriiba1029'
        })
    });
    
    const data = await response.json();
    
    if (response.ok) {
        // Guardar token en localStorage
        localStorage.setItem('jwt_token', data.token);
        localStorage.setItem('user_info', JSON.stringify(data.user_info));
        localStorage.setItem('token_expires', Date.now() + (data.expires_in * 1000));
    }
}

// 2. Usar token en peticiones
async function getDatos() {
    const token = localStorage.getItem('jwt_token');
    
    const response = await fetch('http://localhost:3000/api/pedidos', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        }
    });
    
    const datos = await response.json();
    return datos;
}

// 3. Verificar expiraci√≥n
function verificarToken() {
    const expira = localStorage.getItem('token_expires');
    
    if (Date.now() > parseInt(expira)) {
        alert('Sesi√≥n expirada');
        localStorage.clear();
        window.location.href = 'Admiin.php';
    }
}</code></pre>
            </div>
        </div>

        <!-- Ejemplo 5: Cache -->
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">5Ô∏è‚É£ Manejo de Cache</h5>
            </div>
            <div class="card-body">
                <h6>‚úÖ Lo que S√ç se cachea:</h6>
                <ul>
                    <li><strong>Token JWT:</strong> En <code>$_SESSION['jwt_token']</code> (servidor)</li>
                    <li><strong>Datos de usuario:</strong> En <code>$_SESSION['user_info']</code></li>
                    <li><strong>Expiraci√≥n:</strong> En <code>$_SESSION['token_expires_in']</code></li>
                    <li><strong>LocalStorage (navegador):</strong> Opcional para apps SPA</li>
                </ul>

                <h6 class="mt-3">‚ùå Lo que NO se cachea:</h6>
                <ul>
                    <li>Headers HTTP (se env√≠an en cada petici√≥n)</li>
                    <li>Contrase√±as (nunca se guardan)</li>
                    <li>Datos sensibles temporales</li>
                </ul>

                <h6 class="mt-3">‚ôªÔ∏è Limpiar cache al cerrar sesi√≥n:</h6>
                <pre><code class="language-php">&lt;?php
require_once 'api_client.php';

$api = getAPIClient();
$api->logout(); // Limpia token de sesi√≥n

// O manualmente:
session_destroy();
unset($_SESSION['jwt_token']);
?&gt;</code></pre>
            </div>
        </div>

        <!-- Resumen -->
        <div class="alert alert-info">
            <h5>üìå Resumen del Flujo</h5>
            <ol>
                <li><strong>Login:</strong> Usuario ingresa credenciales en <code>Admiin.php</code></li>
                <li><strong>API:</strong> Se hace POST a <code>http://localhost:3000/auth/login</code></li>
                <li><strong>Token:</strong> La API retorna JWT que se guarda en <code>$_SESSION['jwt_token']</code></li>
                <li><strong>Peticiones:</strong> Usar <code>APIClient</code> que incluye el token autom√°ticamente</li>
                <li><strong>Cache:</strong> El token permanece en sesi√≥n hasta que expire o cierre sesi√≥n</li>
            </ol>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
</body>
</html>
